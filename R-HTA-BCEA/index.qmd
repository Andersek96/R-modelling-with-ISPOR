---
#################################################################################################################################################
# Information about the presentation --- change this block to specify data for the presentation
params:
   title: "Introduction to R for Health Economics using BCEA"
   shorttitle: "Intro to R in HTA & [BCEA](https://gianluca.statistica.it/software/bcea)"
   author: Gianluca Baio
   affiliation: UCL
   date: 6 November 2022
   institute: "[Department of Statistical Science](https://www.ucl.ac.uk/statistics/) | University College London"
   conference: "Health Economic Modeling in R: A Hands-on Introduction <br> ISPOR Europe 2022"
   location: "Vienna, Austria"
   shortlocation: '[ISPOR Europe 2022](https://www.ispor.org/conferences-education/conferences/upcoming-conferences/ispor-europe-2022)'
#################################################################################################################################################
#
#################################################################################################################################################
# The rest of the parameters are automatically generated/created by the code below, so DO NOT MODIFY (unless you know what you're doing...)
#################################################################################################################################################
#
# Creates a short format for the date (to include in the footer)
shortdate: '`r format(as.Date((if(!is.null(params$date)){params$date} else {format(Sys.Date(),"%e %B %Y")}),format="%e %b %Y"),"%e %b %Y")`'
shortdate-link: '`r paste0("<a href=\"https://en.wikipedia.org/wiki/",format(format(as.Date((if(!is.null(params$date)){params$date} else {format(Sys.Date(),"%e %B %Y")}),format="%e %b %Y"),"%B_%d")),"\" title=\"On this day...\" target=\"_blank\">",format(format(as.Date((if(!is.null(params$date)){params$date} else {format(Sys.Date(),"%e %B %Y")}),format="%e %b %Y"),"%e %b %Y")),"</a>")`'
#
# Creates the basic social buttons to include in the footer
social: |
   <a style="border-bottom: 0px!important;" href="https://twitter.com/giabaio" title="Follow me on Twitter"><i class="fa-brands fa-twitter" style="color:black;"></i></a>&nbsp;
   &nbsp;<a style="border-bottom: 0px!important;" href="https://github.com/giabaio" title="Check out my repos"><i class="fa-brands fa-github" style="color:black"></i></a>&nbsp;
   &nbsp; <a style="border-bottom: 0px!important;" href="mailto:g.baio@ucl.ac.uk" title="Email me"><i class="fa-solid fa-envelope" style="color:black"></i></a>&nbsp;
   &nbsp; <a style="border-bottom: 0px!important;" href="https://gianluca.statistica.it" title="Visit my website"><i class="fa-brands fa-firefox" style="color:black"></i></a>
#
# Ensures that the name of the resulting html file is the same as the presentation title
pagetitle: "{{< meta params.title >}}"
#
# Specifies the format and all revealjs options
format: ucl-revealjs
#
# Allow for emojis
from: markdown+emoji
#
# Adds bibliography and style for references
bibliography: /home/gianluca/Dropbox/Perso/Office/CV/mypubs.bib
csl: assets/macros/harvard.csl
#
# Adds logo on selected slides (*not* title slide or those with `nobar` class - courtesy of Alebaio)
include-after-body: assets/macros/insert-logo.html
---

```{r}
#| include: false
# This loads relevant helper functions 
source("assets/setup.R")
```

```{r} 
#| child: "assets/title-slide.qmd"
```

## Disclaimer 

<center>
<blockquote class="twitter-tweet"><p lang="en" dir="ltr">Best opening sentence <a href="https://twitter.com/hashtag/ISPOREurope?src=hash&amp;ref_src=twsrc%5Etfw">#ISPOREurope</a> from Gianluca Baio: “statisticians should rule the world and Bayesian statisticians should rule all statisticians” <a href="https://t.co/GN2w7liAcR">https://t.co/GN2w7liAcR</a></p>&mdash; Manuela Joore (`@ManuelaJoore`) <a href="https://twitter.com/ManuelaJoore/status/1191397718930939904?ref_src=twsrc%5Etfw">November 4, 2019</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script> 
</center>

...Just so you know what you're about to get into... :wink:

## Health technology assessment (HTA) {transition="fade-in slide-out" transition-speed="slow"}

**Objective**: Combine [costs]{.red} and [benefits]{.blue} of a given intervention into a rational scheme for allocating resources 


::: {.r-stack}

![](img/hta-scheme1.png){.fragment width="80%"}

![](img/hta-scheme2.png){.fragment width="80%"}

![](img/hta-scheme3.png){.fragment width="80%"}

![](img/hta-scheme4.png){.fragment width="80%"}

:::


## Health technology assessment (HTA) {transition="fade-in slide-out" transition-speed="slow" visibility="uncounted"}

For each module, we may need/use different/specific packages! (the "R-HTA-verse"?)

:::: {.r-stack}

![](img/hta-scheme5.png){.fragment width="80%"}

![](img/hta-scheme6.png){.fragment width="80%"}

::::

## R & HTA

### What is `R`?

- `R` is a very powerful **statistical software** 
   - Specifically designed for statistical analysis
   - **Very** large community of contributors &ndash; basically you can find code/packages to do any statistical analysis you need
   - [**Open source and free**]{.red}
   

## R & HTA {visibility="uncounted"}

### What is `R`?

- `R` is a very powerful **statistical software** 
   - Specifically designed for statistical analysis
   - **Very** large community of contributors &ndash; basically you can find code/packages to do any statistical analysis you need
   - [**Open source and free**]{.red}


### Why use `R`?

- Everything can be (and almost invariably is) scripted 

- This helps with:
   - Reproducibility
   - Sharing your work with colleagues
   - Reusing templates for "similar" projects
   - ["**Transparency**"]{.myblue}!

- **Fantastic** graphical capability
   - Especially with new [`tidyverse`](https://www.tidyverse.org/) packages ([`ggplot2`](https://ggplot2.tidyverse.org/))

- Generally **fit for purpose** 
   - You **need** advanced tools for many (most??) of the models you do...

:::: {.nobar}
## {background-iframe="https://r-hta.org/" background-interactive=true}

::: footer
   
:::
::::

## But...

> "*Transparency is in the eye of the beholder*"
>
> (Andy Briggs at the [R-HTA workshop](https://www.youtube.com/channel/UCUog4U8cjXuQIvINSDsiEJQ) &ndash; October 2020)

{{< youtube HCsJ8nqNttU?start=270&end=295 >}}

<!-- NB: the file '_extension/giabaio/youtube/youtube.lua' has been modified to force height and width to be 40%! -->

. . .
  
::: {style="position: absolute; left: 0%; top: 75%;"} 
- There **is** an entry cost

- And more importantly, the effort goes hand in hand with sophistication in the statistical modelling associated with the economic evaluation!

:::


:::: {.nobar visibility="uncounted"}
## {background-image="img/chandler.gif" background-size="cover"}

::: footer
:::
::::


<!-- 
## Fun with colours & spaces

### With a subtitle

This shows how to use colours in the slides. A bunch are pre-defined in the `.css` file and can be used simply as:

- The [**predictive**]{.red} distribution can be computed as follows.

. . .

More can be created by simply modifying the `.css` file to add more `HEX` codes.

- For example use

   ```
   {css}
   .uclblue {
     color: #002855;
   }
   ```
   (though this colour is already defined)

- The default is in [`assets/css/styles.css`](assets/css/styles.css){target="_blank"} template or create new ones...

`r vspace("20px")`

Can add vertical space using the command 
```{r echo=T,eval=FALSE,prompt=FALSE}
`r vspace("XXX")`
```
where `XXX` is a suitable unit, eg `"20px"`.


## Some maths

We can also include maths, using standard $\rm\LaTeX$:

$$\class{myblue}{p(y\mid\mathcal{D}) = \int p(y\mid\bm\theta)p(\boldsymbol\theta\mid\mathcal{D})d\boldsymbol\theta} $$

To use colours with $\rm\LaTeX$, needs a little hack: `$\class{color}{expression}$`

You can define a probabilistic assumption as
[$$y \mid \bm\theta \sim \dpois(\bm\theta) $$]{.myblue}
but in line it would look like this $\color{MidnightBlue}{y\sim \dnorm(\mu,\sigma^2)}$ or [$y\sim \dt(\mu,\sigma^2)$]{.red}

These use the predefined $\rm\LaTeX$ macros, saved in the file [`assets/macros/latex_macros.html`](assets/macros/latex_macros.html){target="_blank"}. More can be (re)defined by simply adding to the file, which gets pre-loaded at the beginning of the resulting `.html` output

`r vspace("2rem")`
For instance, the command `$\dnorm$` translates to the text Normal (typeset in the current font)


## Some maths {visibility="uncounted"}

In case you have more text with the same title and don't want to increase the slide counter... (just add `{visibility="uncounted"}` to the slide title)

- Similarly, just adding `{visibility="hidden"}` to the slide title makes it hidden

. . .

- Fontawesome works using `shortcodes`, for example  
```
[{{{< fa smile >}}}]{.red65blue}
```
renders as [{{< fa smile >}}]{.red65blue}

- Other utilities (eg from `ai`) can be included using pure `HTML`, eg

```
<i class="ai ai-pubmed"></i>
```
produces <i class="ai ai-pubmed"></i>

## Other LaTeX stuff

There's also a file [`assets/macros/latex_colours.tex`](assets/macros/latex_colours.tex){target="_blank"}, which can be used in LaTeX chunks, eg
```
\input{assets/macros/latex_colours.tex}
\begin{center}
\begin{tikzpicture}
...

```

- This would be an `{r}` chunk with header like this: 
```
{r}
#| engine: "tikz"
#| echo: false
#| opts: list(width="85%",title="INSERT TEXT HERE")
```

- Then all the colours and, possibly other advanced LaTeX macro defined in [`assets/macros/latex_colours.tex`](assets/macros/latex_colours.tex){target="_blank"} are accessible by `tikz` chunks


- But also, the "extension" `"color.js"` (loaded in [`assets/macros/latex_colours.tex`](assets/macros/latex_colours.tex){target="_blank"}) enables semi-standard LaTeX colouring

- For example `$\displaystyle \color{olive} x^2=\frac{d}{dx}f(x)$` renders as
$\displaystyle \color{olive} x^2=\frac{d}{dx}f(x)$, which essentially looks the same as when using `$\class{color}{math formula}$` or even `[math formula]{.color}` (assuming `color` is defined!)


## Numbered lists & references
- This is a bullet list and $\class{spanish-yellow}{\theta \sim \dgamma(\alpha,\beta)}$ [@Baio:2012]
   - Test

- And another
   1. With a numbered item [@Baio:2019]
   2. And another

- With more items


Can reset the counter of a list
```
<ol style="counter-reset: fancy-counter 9;">
  <li>Number Ten</li>
  <li>Number Eleven</li>
</ol>
```
which renders as

<ol style="counter-reset: fancy-counter 9;">
  <li>Number Ten</li>
  <li>Number Eleven</li>
</ol>


## A page with left & right columns

:::: {.columns}
::: {.column width="40%"}

Some content here

::: {.content-visible when-format="html"}
```{r}
#| eval: !expr knitr::is_html_output()
tab=tibble(
  names=c("Gianluca","Marta","Kobi","Anna"),
  sex=c("Male","Female","Male","Female")
)

# See: https://haozhu233.github.io/kableExtra/awesome_table_in_pdf.pdf
library(kableExtra)
tab %>% kable(bootstrap=TRUE,col.names=c("Name","Sex")) %>%  kable_styling(font_size = 28) %>% 
  column_spec(1,width="25%") %>% column_spec(2,width="65%") %>% 
  row_spec(0,extra_css="border-bottom: 1px solid") %>% 
  row_spec(nrow(tab),extra_css="border-bottom: 1px solid")
```
:::
:::

::: {.column width="60%"}
Just a test to see what happens here even if the text is really long
:::
::::


## Or panelsets {.scrollable}

::: {.panel-tabset}

## Plot

```{r}
#| eval: false
library(ggplot2)
ggplot(mtcars, aes(hp, mpg, color = am)) +
  geom_point() +  geom_smooth(formula = y ~ x, method = "loess")
```

## Data

```{r}
knitr::kable(mtcars)
```
:::   

Learn more: [Tabsets](https://quarto.org/docs/presentations/revealjs/#tabsets)


## More on graphs

- The file [`assets/setup.R`](assets/setup.R){target="_blank"} contains a bunch of `R` commands to create functions and shortcuts that can be used with the normal `qmd` code

- Also, it contains some extra functions and customisation to tell `knitr` how to process the `qmd` file
   - Specifically, in order to create an ["alternative text"](https://en.wikipedia.org/wiki/Alt_attribute), it uses a trick
   - This essentially means that the width of any graph created by `R` is controlled by the extra "chunk" option 
   
   ```
   {r} 
   #| eval: false
   #| echo: true
   opts=list(...)
   ```
   
   which contains various elements
   
   ```
   {r} 
   #| eval: false
   #| echo: true
   opts=list(
    width="X%",
    title="SOME TEXT",
    alt="SOME TEXT",
    ...
   )
   ```
   
   - `title` will produce the actual "alt text", while `alt` will simply add some text to the `html` file (that can be read out for accessibility)


:::: {.nobar}
## {background-iframe="https://r-hta.org/" background-interactive=true}

::: footer
:::

::: {.notes}
This block activates speaker's notes &ndash; and this slides shows how you can include full websites inside the slide using this code
:::
::::

-->

## References 

:::: {#refs}
::::

`r vspace("500px")`

::: aside
See also [https://quarto.org/docs/authoring/footnotes-and-citations.html](https://quarto.org/docs/authoring/footnotes-and-citations.html)
:::



:::: {.nobar}
## {background-image="assets/images/reese.gif" background-size="cover"}

::: footer
:::
::::
